```
+++
author = "kmplex"
title = "기초부터 다지는 ES 운영노하우 1-2장"
date = "2021-04-04"
description = "Elastic Search 1-2장"
series = ["ES"]
categories = ["dev"]
+++
```

## 01 엘라스틱 스택이란 

#### Elastic Search 의 탄생 

- ES 가 등장했을 무렵, 사용자는 `전문 검색 (full text search)` 기능이 필요했다.
  - 벤더들사가 제공하는 값비싼 솔루션에 의존할 수 밖에 없었음
- 루씬 기반으로 만들어진게 Elastic Search

#### Elastic Stack 으로 발전

- 단순 검색엔진을 뛰어넘는 Platform 으로 성장함
  - 데이터 수집 / 가공 / 저장 / 분석 / 시각화 등 일련의 파이프라인을 제공함
  - Kibana / Logstash 등과 함께 Elastic Stack 을 구성함
    - 2015년 10월 부터 버전을 동일하게 맞춤 
  

#### Elastic Stack 구성 요소

- Beat / Logstash 데이터를 수집하고 / 가공한다.
- ES 데이터를 저장 / 분석하며 
- Kibana 는 ES 에 저장된 데이터를 시각화 및 모니터링 한다.

#### Elastic Search: 분산 검색 엔진 

- ES 는 검색 엔진 및 DataBase의 역할을 수행한다.
  - 모든 레코드를 Json 형태로 입력 및 관리하며
  - 쿼리를 사용할 수 있으며 다양한 DataType 을 지원한다.
- ES 는 최적화된 자료 구조를 바탕으로 분산 / 병렬 처리를 지원한다.
  - Text / Document 의 경우 인덱싱 시점에 분석을 거쳐 용어 단위로 분해하여 역 인덱스 사전을 구축한다.
  - 숫자 / 키워드 타입의 데이터는 집계에 최적화된 컬럼 기반 자료구조로 저장한다.
- Scoring (유사도 스코어)를 제공한다.
  - 루씬에 기반하여, 최적화된 자료구조 및 스코어링을 지원한다.
  - 나아가 분산 시스템으로 확장하여 성능 / 유연성 활용성면에서 개선을 이뤄냈다.
  - 복수개의 인스턴스를 병렬로 배치하고 분산 처리해, 검색 속도를 확장한다.
    - 또한 노드 장애 시, 정상 서비스를 지속할 수 있게 복제 기능을 제공한다.
- Rest API 로 동작하여, 높은 활용성을 제공한다.
- 위 성능을 끌어올리기위해 trade-off 가 이루어졌다.
  - 저장공간이 크게 압축되지 않아, 리소스를 많이 사용한다
  - JOIN 쿼리가 어려워, 반 정규화를 기본으로 모델링해야하며, Index 가 불변 자료형이기에, 수정 / 삭제의 비용이 저렴하지 않다.


#### Kibana: 시각화와 Elastic Search 관리 도구

- ELK 의 UI를 담당한다.
  - Elastic Search 에 대한 대부분의 관리 / API Console / Monitoring page / **시각화 DashBoard** 등을 제공한다.

#### Logstash : 이벤트 수집과 정제를 위한 도구

- 데이터 수집과 가공 기능을 제공한다.
  - Filter 기능을 이용해 데이터를 분석하기 쉬운 형태로 정제할 수 있고, 다양한 플랫폼으로의 전송도 제공한다. ex) Kafka 로도 전송 가능
  - 형식에 무관하게 데이터를 동적으로 수집 / 변환 / 전송하는 구조로 되어있음
- 다양한 Plugin 들도 제공하며, ES Indexing 최적화를 위한 배치 처리 및 병렬 처리또한 가능하다.
- 영속적인 큐를 사용하며, 데이터양이 급증하는 부하 상황에서도 안정성을 보장해준다.
- 가급적 Logstash 만으로 데이터 수집을 하는게 관리 / 안정성 측면에서 장점이 많다.

#### Beat : 엣지단에서 동작하는 경량 수집 도구

- 이벤트 정보를 수집하기 위해 host 에 수집기 설치가 필요함
  - Logstash는 다양한 필터 / 설정들로 무거움
- 이를 위해 `경량 수집기` (Beat) 가 등장함.
- Beat 는 로그 수집 / 시스템 지표 수집등 특정 목적에 최적화된 agent 
  - 목적에 맞게, 복잡한 이벤트 가공은 지원하지 않음
- 위같은 특징으로, Beat 와 logstash 를 혼합하여 사용한다.


## Elastic Stack 의 용도

#### 전문 검색 엔진 

- 가장 기본적인 사용처는 전문 검색 엔진 구현 
  - Full text 는 단순한 문장 부터 논문 등 다양한 글의 전체 내용을 의미한다.
  - 일반적은 Like 질의는 성능에 이슈가 있어, 데이터가 조금만 많아져도 사용할 수 없다. (Index를 타지않음)
- 전문 검색을 지원하기 위해, 용어 `terms` 단위로 분석해 Indexing을 해두고, 이를 기반으로 검색을 수행하는 역 인덱싱 기법이 많이 활용된다.
- 용어 분석을 위한 다양한 언어별 분석기를 제공하며, 유사도 스코어링을 위한 다양한 방법 또한 제공한다.
- 전문 검색 엔진 외에도 외부 검색 엔진으로도 활용된다.

#### 로그 통합 분석 

- Application 에서 발생하는 로그 분석용으로도 사용된다.
  
#### 보안 이벤트 분석 

- 다양한 이벤트를 수집 / 분석하는 용도로 사용 할 수 있다.
  
#### Application 성능 분석 

- APM 의 역할로도 사용 할 수 있다.
  - Metric 정보를 수집해서 Grafana 로 사용 가능 
  
#### 머신러닝

- 유료 라이선스로 DL 을 사용할 수 있다.

#### 카프카와 연동 

- Beat 로 수집한 이벤트를 카프카로 전송 할 수 있다.
  - 이를 Logstash / ES 등 pipeline 을 형성 할 수 있다.
  - 데이터 유실 방지 및 타 시스템 연계가 쉬워진다.

#### 관계형 DB 와의 연동

- Logstash 는 DB 와 연계할 수 있는 다양한 방법을 제공한다.
- DB 를 ES 로전환하기도 한다.

#### 유사 제품과의 비교

- PostgreSQL 과 같은 DB 에서도 Json 형태를 지원한다.
  - 다만 근본이 검색 엔진이기에, 데이터를 빠르게 검색 할 수 있다.
  - 대신 시스템 리소스를 많이 사용한다.
    - 변하지 않은 시계열 데이터 유형을 다루기에 좋다
- ES는 Solr 와 비교하여, 각 장/단점을 갖고 있다.
- logstash 는 fluentd 와 유사한데, 각 자신만의 영역을 점유하고 있다.
  - [함께보면 좋은 글](https://bcho.tistory.com/1115)
