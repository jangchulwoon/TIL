```
+++ 
author = "kmplex" 
title = "unit testing 3부" 
date = "2022-02-06" 
description = "unit testing 3부"  
series = ["unit testing"] 
categories = ["dev","test"] 
+++
```

[Unit Testing](http://www.yes24.com/Product/Goods/104084175)를 읽고 짤게 정리한 내용입니다.

## 3부 통합 테스트  

#### 8장 통합 테스트를 하는 이유

- 통합 테스트는 단위 테스트가 아닌 테스트에 해당한다.
  - 프로세스 외부 의존성과 통합해 작동하는 방식을 검증한다.
  - 단위 테스트는 알고리즘 / 도메인 모델을 다루고, 통합 테스트는 Controller 를 다룬다.
    - 모든 의존성 흐름을 테스트하며 (Happy case), 특정 에러들은 단위 테스트로 대체할 수 있다. 
    - (개인적인 생각) 에러 응답을 확인하기 위해서라도, 최소한의 실패 케이스는 작성하는게 맞는거 같음
  - 통합 테스트는 회귀 방지와 리팩터링 내성이 우수하며, 단위 테스트는 유지 보수 및 피드백 속도가 우수하다
- 통합 테스트에서 회귀 방지와 리팩터링 내성 지표에 대한 점수는 단위 테스트 보다 유지보수성과 피드백 속도가 떨어진 만큼 높아야한다. (Test pyramid)
  - 단위 테스트를 통해 가능한 많은 비즈니스 시나리오의 예외 상황을 확인하고,  단위 테스트로 확인할 수 없는 예외 상황을 다루도록 해라
- 비 관리 의존성에만 Mock 을 사용하라 (application 에서만 접근 할 수 있는 DB 등은 Mock 을 사용하지 마라) 
- 구현이 하나뿐인 인터페이스를 사용하기에 타당한 이유는 Mock 을 사용하기 위한 것 뿐이다.
  - 미래를 예측하여 Interface 를 두는건 안티 패턴이다.
  - Mock 을 위한 Interface는 framework 로도 지원하므로, 불필요하다고 생각됨
- 간접 계층이 많아지면 코드 추론이 어려워진다. 
  - Domain / application / infra 만 있어야한다. (Web 은 별개인듯)
- 실행 구절이 여러개 인것은 비 관리 의존성으로 작동하는 경우 타당하다. 
  - 그 외는 실행 구절이 하나여야한다.
- 개발 용도의 로깅은 테스트 하지마라 (비즈니스 요구사항이 아님)
  - 도메인 계층에 로깅 의존 (프로세스 외부 의존)을 넣지 말라고하는데, 공감가지 않음

#### 9장 목 처리에 대한 모범 사례 / 10장 데이터베이스 테스트

- 목은 비관리 의존성만을 위한 것이고, 의존성은 Controller 에서만 갖고 있으므로, 통합테스트 에서 Controller 를 테스트할때만 Mock 을 사용하라
  - 단위 테스트에서는 목을 사용하지 마라
- 테스트 시작 시점에 남은 데이터(DB)를 정리하라. 
- SQLite 같은 인메모리 DB를 사용하지마라
  - 테스트에서도 운영 환경과 같이 동일한 DBMS 를 사용하라 (맞는것도 같고/ 살짝 반발심도 들고 ..)
  
#### 후기

책 마지막 부분(3부) 부터, 뜬 구름 잡는 느낌 혹은 WEB 에서는 납득하기 어려운 설명들이 이어진거 같다.

`Log 는 외부 의존성이니,  Domain 부분에 의존성을 넣지 마라` 

> 그럴수가 있나 ?

`단위 테스트로 커버 안되는 영역만 통합 테스트로 작성하라`

> 단위 테스트는 도메인 유의성 / 복잡한 코드를 테스트한다고 설명하는데,
> ServiceLayer 나 PresentationLayer 는 통합 테스트로 커버가 불가능 할거 같은데 ?
> Test suite 를 어떻게 구성하라는 말이지?

그래서 요약 부분만 훑고 책을 마무리 진다.
그럼에도  Mock으로 인한 리팩터링 내성 (`거짓 양성`) / 단위 테스트의 4가지 지표 (`유지보수성`,`빠른 피드백`, `회귀` , `리팩터링 내성`)와 테스트 피라미드 / 도메인 영역 테스트 등 재밌는 부분이 있는 책인거 같다.







