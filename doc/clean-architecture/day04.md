```
+++
author = "kmplex"
title = "만들면서 배우는 클린아키텍처 4일차"
date = "2022-11-14"
description = "만들면서 배우는 클린 아키텍처 8장~9장"
series = ["clean architecture"]
categories = ["study","ddd"]
+++
```

## 경계 간 매핑하기

`매핑에 찬성하는 개발자` - 두 계층 간에 매핑을 하지 않으면, 양 계층에서 같은 모델을 사용하게 되고 강하게 결합된다.

`매핑에 반대하는 개발자` - 두 계층을 매핑하게 되면, 보일러플레이트 코드가 너무 많아지며, 단순한 코드에서 매핑은 너무 과하다.

#### 1. 매핑하지 않기 전략 

모든 계층이 같은 모델을 사용하는 구조로, 단일 책임 원칙을 위반하며 한 계층에서만 필요한 필드들을 포함하는 `파편화된 도메인 모델` 로 이어질 수 있다.

다만, 간단한 CRUD 혹은 모든 계층이 정확히 같은 구조의, 정확히 같은 정보를 포함한다면, 매핑하지 않기 전략이 유효할 수 있다.

> 다만, 이후 설계에 따라 전략을 수정 할 수 있다.

`개인적인 생각`

가장 별로라고 생각함.
서비스가 유지보수될 수록 결국 매핑하는 전략(?)으로 수정될거 같음

#### 양방향 매핑 전략 

각 계층이 전용 모델을 가진 매핑 전략.

각 계층이 전용 모델을 갖고 있기 때문에, 변경하더라도 다른 계층에 영향이 없다. 
이러한 전략은 웹 / 영속성 관심사로 오염되지 않은 깨끗한 도메인 모델로 이어진다.

다만, 1) 너무 많은 보일러 플레이트 코드가 생기며, 2) 도메인 모델이 계층 경계를 넘어 통신에 사용된다.

#### 완전 매핑 전략 

각 연산마다 별도의 입출력 모델을 사용한다. (incoming / outgoing 에도 별도 모델을 사용)

더 많은 보일러 플레이트 코드가 생기지만, 결합도가 떨어져 유지보수가 더 용이해질 수 있다.

#### 단방향 매핑 전략 

모든 계층의 모델들이 같은 인터페이스를 구현하고, getter 를 제공하여 상태를 캡슐화한다.

> DDD 의 Factory 라는 개념과 잘 어울린다.

Interface 로 모델을 매핑하고, factory pattern 을 사용하여 내부 상태를 캡슐화 할 수 있다.

해당 전략은 계층 간의 모델이 비슷할 때 가장 효과적이다.

#### 어떤 매핑을 사용 할 것인가 ?

`그떄그때 다르다.`

각 매핑 전략이 저마다 장단점을 갖고 있기에, 한 전략을 전체 코드에 대한 전역 규칙으로 정의해서는 안된다.

또한 여러 매핑전략을 동시에 사용하기 위해선, 팀 내의 명확한 가이드가 필요하다. 

`개인적인 생각`

한가지 방식을 고정으로 가져가되, 특수한 상황(ex) admin / batch )에서 매핑하지 않는 전략을 사용하는게 좋다고 생각함.

## 애플리케이션 조립하기

이전까지 만든 의존성을 누가 주입할 것인지에 대한 이야기

annotation 방식과 java config 방식을 설명하는데, 특별히 인상깊은 부분은 없었음.

library 혹은 framework 개발자라면, framework 특화 annotation 사용을 지양해야한다.(?) 

> 서비스 개발자라서 해당 사항 없을 듯.. 

